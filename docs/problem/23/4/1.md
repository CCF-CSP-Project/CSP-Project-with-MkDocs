# 202109-4 收集卡牌

## 20% 数据——搜索

我们可以直接深搜解决。考虑需要维护的状态量：

1. 目前抽了几次卡 $cost$，用来计算期望；
2. 转移到某个抽卡状态的概率 $p$，用来计算期望；
3. 目前持有卡的状态 $state$，用来统计获得卡片还是获得金币，以及判断游戏结束。注意这里是统计每张卡牌的情况，而不是总共有多少张牌；
4. 硬币个数 $coin$，用来判断游戏结束；

假设目前的状态是 $(cost, p, state, coin)$，考虑下一步转移的方向：

1. 通过 $state$ 可以得知**未获得**的牌的个数 $tot$，若 $coin \ge tot * k$，则说明目前可以用硬币买到所有的卡牌，对答案贡献 $p\cdot cost$；
2. 否则，我们要继续抽卡，枚举抽到牌的所有情况。假设目前抽到的卡牌为 $i$，结果分为两种情况：
    1. 目前抽到的卡牌已经存在，即 $2^i\ \&\ state \not= 0$。该卡牌会转换为一个硬币，转移到的下个状态为 $(cost + 1, p \cdot p_i, state, coin + 1)$；
    2. 目前抽到的卡牌不存在，即 $2^i\ \&\ state = 0$。需要更新持有卡牌的状态，转移到下个状态为 $(cost + 1, p \cdot p_i, state\ |\ 2^i, coin)$；